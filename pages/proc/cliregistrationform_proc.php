<?php

$aamembercode = (isset($_REQUEST['aamembercode'])?$_REQUEST['aamembercode']:'');
$aafirstname = (isset($_REQUEST['aafirstname'])?$_REQUEST['aafirstname']:'');
$aamiddlename = (isset($_REQUEST['aamiddlename'])?$_REQUEST['aamiddlename']:'');
$aasurname = (isset($_REQUEST['aasurname'])?$_REQUEST['aasurname']:'');
$aasex = (isset($_REQUEST['aasex'])?$_REQUEST['aasex']:'');
$aacivilstatus = (isset($_REQUEST['aacivilstatus'])?$_REQUEST['aacivilstatus']:'');
$aapurok = (isset($_REQUEST['aapurok'])?$_REQUEST['aapurok']:'');
$aabarangay = (isset($_REQUEST['aabarangay'])?$_REQUEST['aabarangay']:'');
$aamunicipality = (isset($_REQUEST['aamunicipality'])?$_REQUEST['aamunicipality']:'');
$aaprovince = (isset($_REQUEST['aaprovince'])?$_REQUEST['aaprovince']:'');
$aavalidid = (isset($_REQUEST['aavalidid'])?$_REQUEST['aavalidid']:'');
$aabirthdate = (isset($_REQUEST['aabirthdate'])?$_REQUEST['aabirthdate']:'');
$aaage = (isset($_REQUEST['aaage'])?$_REQUEST['aaage']:'');
$aabithplace = (isset($_REQUEST['aabithplace'])?$_REQUEST['aabithplace']:'');
$aaoccupation = (isset($_REQUEST['aaoccupation'])?$_REQUEST['aaoccupation']:'');
$aareligion = (isset($_REQUEST['aareligion'])?$_REQUEST['aareligion']:'');
$aapayorname = (isset($_REQUEST['aapayorname'])?$_REQUEST['aapayorname']:'');
$aapayorage = (isset($_REQUEST['aapayorage'])?$_REQUEST['aapayorage']:'');
$aapayorrelation = (isset($_REQUEST['aapayorrelation'])?$_REQUEST['aapayorrelation']:'');
$aapayorcontactno = (isset($_REQUEST['aapayorcontactno'])?$_REQUEST['aapayorcontactno']:'');
$aapayorpurok = (isset($_REQUEST['aapayorpurok'])?$_REQUEST['aapayorpurok']:'');
$aapayorbarangay = (isset($_REQUEST['aapayorbarangay'])?$_REQUEST['aapayorbarangay']:'');
$aapayormunicipality = (isset($_REQUEST['aapayormunicipality'])?$_REQUEST['aapayormunicipality']:'');
$aapayorprovince = (isset($_REQUEST['aapayorprovince'])?$_REQUEST['aapayorprovince']:'');
$aamembercontactno = (isset($_REQUEST['aamembercontactno'])?$_REQUEST['aamembercontactno']:'');
$aabenename = (isset($_REQUEST['aabenename'])?$_REQUEST['aabenename']:'');
$aabenebirthdate = (isset($_REQUEST['aabenebirthdate'])?$_REQUEST['aabenebirthdate']:'');
$aabeneage = (isset($_REQUEST['aabeneage'])?$_REQUEST['aabeneage']:'');
$aabenerelation = (isset($_REQUEST['aabenerelation'])?$_REQUEST['aabenerelation']:'');
$aabenecivilstatus = (isset($_REQUEST['aabenecivilstatus'])?$_REQUEST['aabenecivilstatus']:'');
$aabenecontactno = (isset($_REQUEST['aabenecontactno'])?$_REQUEST['aabenecontactno']:'');
$aadepname1 = (isset($_REQUEST['aadepname1'])?$_REQUEST['aadepname1']:'');
$aadepbirthdate1 = (isset($_REQUEST['aadepbirthdate1'])?$_REQUEST['aadepbirthdate1']:'');
$aadepage1 = (isset($_REQUEST['aadepage1'])?$_REQUEST['aadepage1']:'');
$aadeprelationship1 = (isset($_REQUEST['aadeprelationship1'])?$_REQUEST['aadeprelationship1']:'');
$aadepcivilstatus1 = (isset($_REQUEST['aadepcivilstatus1'])?$_REQUEST['aadepcivilstatus1']:'');
$aadepname2 = (isset($_REQUEST['aadepname2'])?$_REQUEST['aadepname2']:'');
$aadepbirthdate2 = (isset($_REQUEST['aadepbirthdate2'])?$_REQUEST['aadepbirthdate2']:'');
$aadepage2 = (isset($_REQUEST['aadepage2'])?$_REQUEST['aadepage2']:'');
$aadeprelationship2 = (isset($_REQUEST['aadeprelationship2'])?$_REQUEST['aadeprelationship2']:'');
$aadepcivilstatus2 = (isset($_REQUEST['aadepcivilstatus2'])?$_REQUEST['aadepcivilstatus2']:'');
$aadepname3 = (isset($_REQUEST['aadepname3'])?$_REQUEST['aadepname3']:'');
$aadepbirthdate3 = (isset($_REQUEST['aadepbirthdate3'])?$_REQUEST['aadepbirthdate3']:'');
$aadepage3 = (isset($_REQUEST['aadepage3'])?$_REQUEST['aadepage3']:'');
$aadeprelationship3 = (isset($_REQUEST['aadeprelationship3'])?$_REQUEST['aadeprelationship3']:'');
$aadepcivilstatus3 = (isset($_REQUEST['aadepcivilstatus3'])?$_REQUEST['aadepcivilstatus3']:'');
$aadepname4 = (isset($_REQUEST['aadepname4'])?$_REQUEST['aadepname4']:'');
$aadepbirthdate4 = (isset($_REQUEST['aadepbirthdate4'])?$_REQUEST['aadepbirthdate4']:'');
$aadepage4 = (isset($_REQUEST['aadepage4'])?$_REQUEST['aadepage4']:'');
$aadeprelationship4 = (isset($_REQUEST['aadeprelationship4'])?$_REQUEST['aadeprelationship4']:'');
$aadepcivilstatus4 = (isset($_REQUEST['aadepcivilstatus4'])?$_REQUEST['aadepcivilstatus4']:'');
$aaplantype = (isset($_REQUEST['aaplantype'])?$_REQUEST['aaplantype']:'');
$aaunits = (isset($_REQUEST['aaunits'])?$_REQUEST['aaunits']:'');
$aaagent = (isset($_REQUEST['aaagent'])?$_REQUEST['aaagent']:'');
$aainsurance = (isset($_REQUEST['aainsurance'])?$_REQUEST['aainsurance']:'');
$aamembershipdate = (isset($_REQUEST['aamembershipdate'])?$_REQUEST['aamembershipdate']:'');
$aaao = (isset($_REQUEST['aaao'])?$_REQUEST['aaao']:'');
$aabranchmanager = (isset($_REQUEST['aabranchmanager'])?$_REQUEST['aabranchmanager']:'');
$aaprdate = (isset($_REQUEST['aaprdate'])?$_REQUEST['aaprdate']:'');
$aaprno = (isset($_REQUEST['aaprno'])?$_REQUEST['aaprno']:'');
$aaordate = (isset($_REQUEST['aaordate'])?$_REQUEST['aaordate']:'');
$aaornumber = (isset($_REQUEST['aaornumber'])?$_REQUEST['aaornumber']:'');
$aaamount = (isset($_REQUEST['aaamount'])?$_REQUEST['aaamount']:'');

$sql = "";

include "../dbconnect.php";


//update command here
if ($aamembercode!=''){
	$res = mysql_query("SELECT COUNT(*) FROM members_profile WHERE Member_Code = '$aamembercode'") or die('ERROR');
	if (mysql_num_rows($res)>0){
	//update prifle

		$res_profile = mysql_query("
			UPDATE members_profile
				SET 
				`Fname`		='$aafirstname',
				`Mname`		='$aamiddlename',
				`Lname`='$aasurname',
				`Nname`='$aamiddlename',
				`Sex`='$aasex',
				`Status`='$aacivilstatus',
				`Street`='$aapurok',
				`Barangay`='$aabarangay',
				`City`='$aamunicipality',
				`Province`='$aaprovince',
				`IDno`='$aavalidid',
				`Bdate`='$aabirthdate',
				`Age`='$aaage',
				`Bplace`='$aabithplace',
				`Occupation`='$aaoccupation',
				`Religion`='$aareligion',
				`Pname`='$aapayorname',
				`Page`='$aapayorage',
				`Prelation`	='$aapayorrelation',
				`Pcontactno`='$aapayorcontactno',
				`Cstreet`	='$aapayorpurok',
				`Cbarangay`	='$aapayorbarangay',
				`Ccity`		='$aapayormunicipality',
				`Cprovince`	='$aapayorprovince',
				`Mcontactno`='$aamembercontactno',
				`Bname`		='$aabenename',
				`Bbdate`	='$aabenebirthdate',
				`Bage`		='$aabeneage',
				`Brelation`	='$aabenerelation',
				`Bstatus`	='$aabenecivilstatus',
				`Bcontactno`='$aabenecontactno',
				`Dname1`='$aadepname1',
				`Dbdate1`='$aadepbirthdate1',
				`Dage1`='$aadepage1',
				`Drelation1`='$aadeprelationship1',
				`Dstatus1`='$aadepcivilstatus1',
				`Dname2`='$aadepname2',
				`Dbdate2`='$aadepbirthdate2',
				`Dage2`='$aadepage2',
				`Drelation2`='$aadeprelationship2',
				`Dstatus2`='$aadepcivilstatus2',
				`Dname3`='$aadepname3',
				`Dbdate3`='$aadepbirthdate3',
				`Dage3`='$aadepage3',
				`Drelation3`='$aadeprelationship3',
				`Dstatus3`='$aadepcivilstatus3',
				`Dname4`='$aadepname4',
				`Dbdate4`='$aadepbirthdate4',
				`Dage4`='$aadepage4',
				`Drelation4`='$aadeprelationship4',
				`Dstatus4`='$aadepcivilstatus4'

			WHERE Member_Code = '$aamembercode';
		") or die(mysql_error());
/*
		if ($res_profile){
			//update account
			$res_account = mysql_query("
				UPDATE members_account
				SET
				`Plan_Code`='$aaplantype',
				`No_of_units`='$aaunits',
				`Agent`='$aaagent',
				`Insurance_Type`='$aainsurance',
				`Date_of_membership`='$aamembershipdate',
				`PRdate`='$aaordate',
				`PRno`='$aaprno',
				`ORdate`='$aaordate',
				`ORno`='$aaornumber',
				`Amount`='$aaamount',
				`AO`='$aaao',
				`BM`='$aabranchmanager' 
				WHERE `Member_Code`='$aamembercode';
				") or die(mysql_error());
			if (!$res_account){
				echo "SAVE_ERROR";
			}else{
				echo "SAVE_SUCCESS";
				//audit here

			}
*/

		}else{
			echo "SAVE_ERROR";
		}

	



	
}else{


	//insert command here
	$new_member_code = ''; //<Branch CODE 2><VERSION AS '2'><USER id 2><entry 6> ; E.G. data(branch_code:RO;  version:2; userid:2; entry id:1234) = R0+2+01+001234 = R0201001234
	$Branch_Code = $_COOKIE['Branch_Code'];
	$user_id = $_COOKIE['user_id'];
	$version = '02';

	$res_newentryid  = mysql_query('SELECT MAX(entry_id)+1 AS new_entry FROM members_profile');
	$res_newentryid_row = mysql_fetch_array($res_newentryid, MYSQL_ASSOC);
	$new_member_code = $Branch_Code.$version.$user_id.sprintf('%06d', $res_newentryid_row['new_entry']);

	mysql_free_result($res_newentryid);	
	mysql_free_result($res_newentryid_row);


	//default values for new members
	$Installment_No = 1;
	$term=1;
	$Br_Amt=$aaamount;
	$Period_Year = date('Y', strtotime($aamembershipdate));
	$Period_Covered = date('M', strtotime($aamembershipdate));
	$Br_period_covered = date('M', strtotime($aamembershipdate));
	$unit=1;
	$Br_installment_no=1;
	$status = 'Active';

	//echo($Period_Covered);

	$sql_members_profile="


		INSERT INTO members_profile
		(`Fname`,`Mname`,`Lname`,`Nname`,`Sex`,`Status`,`Street`,`Barangay`,`City`,`Province`,`IDno`,`Bdate`,`Age`,`Bplace`,`Occupation`,`Religion`,`Pname`,`Page`,`Prelation`,`Pcontactno`,`Cstreet`,`Cbarangay`,`Ccity`,`Cprovince`,`Mcontactno`,`Bname`,`Bbdate`,`Bage`,`Brelation`,`Bstatus`,`Bcontactno`,`Dname1`,`Dbdate1`,`Dage1`,`Drelation1`,`Dstatus1`,`Dname2`,`Dbdate2`,`Dage2`,`Drelation2`,`Dstatus2`,`Dname3`,`Dbdate3`,`Dage3`,`Drelation3`,`Dstatus3`,`Dname4`,`Dbdate4`,`Dage4`,`Drelation4`,`Dstatus4`,`Member_Code`) 
		values 
		('$aafirstname','$aamiddlename','$aasurname','$aamiddlename','$aasex','$aacivilstatus','$aapurok','$aabarangay','$aamunicipality','$aaprovince','$aavalidid','$aabirthdate','$aaage','$aabithplace','$aaoccupation','$aareligion','$aapayorname','$aapayorage','$aapayorrelation','$aapayorcontactno','$aapayorpurok','$aapayorbarangay','$aapayormunicipality','$aapayorprovince','$aamembercontactno','$aabenename','$aabenebirthdate','$aabeneage','$aabenerelation','$aabenecivilstatus','$aabenecontactno','$aadepname1','$aadepbirthdate1','$aadepage1','$aadeprelationship1','$aadepcivilstatus1','$aadepname2','$aadepbirthdate2','$aadepage2','$aadeprelationship2','$aadepcivilstatus2','$aadepname3','$aadepbirthdate3','$aadepage3','$aadeprelationship3','$aadepcivilstatus3','$aadepname4','$aadepbirthdate4','$aadepage4','$aadeprelationship4','$aadepcivilstatus4','$new_member_code');

		
	";		

	$sql_members_account = "
		INSERT INTO members_account	(`Plan_Code`,`No_of_units`,`Agent`,`Insurance_Type`,`Date_of_membership`,`Current_term`,`Account_Status`,`PRdate`,`PRno`,`ORdate`,`ORno`,`Amount`,`AO`,`BM`,`Member_Code`) 
		VALUES 	('$aaplantype','$aaunits','$aaagent','$aainsurance','$aamembershipdate','$term','$status','$aaprdate','$aaprno','$aaordate','$aaornumber','$aaamount','$aaao','$aabranchmanager' ,'$new_member_code'); 

	";

	$sql_Installment_ledger = "



		INSERT INTO Installment_ledger	(`Member_Code`,`Installment_No`,`Period_Covered`,`Period_Year`,`Amt_Due`,`Units`,`Term`,`Br_period_covered`,`Br_installment_no`,`Br_Amt`,`PRdate`,`PRno`,`ORdate`,`ORno`,`Remarks`,`Insurance_Remarks`) 
		VALUES 	(
		'$new_member_code',
		'$Installment_No',
		'$Period_Covered',
		'$Period_Year',
		'$aaamount',
		'$unit',
		'$term',
		'$Br_period_covered',
		'$Br_installment_no',
		'$Br_Amt',
		'$aaprdate',
		'$aaprno',
		'$aaordate',
		'$aaornumber',
		'',
		''
		) 

	";

			$res_members_profile = mysql_query($sql_members_profile) or die(mysql_error());
			if (!$res_members_profile){
				echo "SAVE_ERROR";
			}else{
				$res_members_account = mysql_query($sql_members_account) or die(mysql_error());
				if (!$res_members_account){
					echo "SAVE_ERROR";
				}else{
					$res_Installment_ledger = mysql_query($sql_Installment_ledger) or die(mysql_error());
					if (!$res_Installment_ledger){
						echo "SAVE_ERROR";
					}else{
						echo "SAVE_SUCCESS";
						//audit here
					}
					mysql_free_result($res_Installment_ledger);
				}
				mysql_free_result($res_members_account);
				
			}
			mysql_free_result($res_members_profile);

			
			
			
			

			
}






//mysql_free_result($res_newentryid_row);



include '../dbclose.php';







	/*
		ERROR KEYWORDS:
			FAILED
			EXISTS
			SUCCESS
	*/


?>